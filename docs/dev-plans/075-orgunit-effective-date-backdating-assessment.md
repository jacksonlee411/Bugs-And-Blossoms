# DEV-PLAN-075：OrgUnit 生效日期不允许回溯的限制评估

**状态**: 规划中（2026-02-05 23:31 UTC）

## 背景与问题
- 用户尝试将 OrgUnit（示例：Root Unit A / `ROOT260205A`）的生效日期改为 `2026-01-01`，系统报错。
- 当前 UI 的“更正（correction）”能力只允许将生效日期向后调整，且必须小于下一条记录的生效日期；不允许回溯至更早日期。

## 目标
- 记录问题与现状约束，明确为什么会报错。
- 评估是否需要支持“更早生效”（backdating）并给出变更范围。

## 现状与约束（SSOT）
- **更正（correction）规则**：生效日期只能向后更正，不允许比目标记录更早；且不得与下一条记录冲突。
- **插入记录（insert_record）规则**：只允许在现有最早与最晚记录之间插入，不能早于最早记录。
- 违反以上规则时，会出现 `EFFECTIVE_DATE_OUT_OF_RANGE` / `EVENT_DATE_CONFLICT` 等错误。

## 影响与问题表现
- 当用户输入 `2026.1.1`（非 `YYYY-MM-DD` 格式）会触发 `EFFECTIVE_DATE_INVALID`。
- 当用户尝试将现有记录更正为更早日期，会触发 `EFFECTIVE_DATE_OUT_OF_RANGE`。
- 若目标日期已存在记录，会触发 `EVENT_DATE_CONFLICT`。

## 评估方向（待确认）
1. **保持现状**：明确“更正”仅允许向后调整；更早生效需新增记录并调整业务流程。
2. **支持更早生效**：需要契约变更与校验规则重写，可能影响：
   - 事件序列稳定性（版本排序/有效期边界）
   - 读路径（as_of 解析结果变化）
   - UI 行为与提示语
   - 迁移/回放一致性与审计语义

## 实施步骤（若决定支持更早生效）
1. [ ] 业务确认：是否必须支持“更早生效”与可接受的约束（是否允许跨越已有记录）。
2. [ ] 契约更新：修订 `DEV-PLAN-073/032/031` 中的有效期/更正规则（仅引用 SSOT，不复制门禁矩阵）。
3. [ ] 规则调整：更新更正逻辑与数据库校验，确保不破坏事件序列一致性与冲突检查。
4. [ ] UI/错误提示：补充更清晰的“为什么不允许回溯”的前端提示与帮助文案。
5. [ ] 验收与记录：补充执行记录与测试证据。

## 交付物
- 评估结论与决策记录（是否支持更早生效）。
- 若变更：契约文档更新与实现计划。

## 关联文档
- `AGENTS.md`
- `docs/dev-plans/073-orgunit-crud-implementation-status.md`
- `docs/dev-plans/032-effective-date-day-granularity.md`
- `docs/dev-plans/031-greenfield-assignment-job-data.md`
