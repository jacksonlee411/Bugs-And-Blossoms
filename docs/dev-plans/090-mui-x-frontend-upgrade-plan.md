# DEV-PLAN-090：前端框架升级为 MUI X（对标 Workday UX）

**状态**: 已完成（2026-02-22 17:40 UTC）

> 2026-02-22 收口说明：本计划对应子计划 `DEV-PLAN-091/092/093/094/095` 与 org 承接收口 `DEV-PLAN-096/097` 已完成并归档；本计划作为升级总方案保留在 `docs/dev-plans/` 作为阶段性总览 SSOT。

## 1. 背景与动机

当前 HR SaaS 场景的核心交互以“高密度数据 + 多维筛选 + 树形结构 + 批量操作 + 审批流”为主。为对标 Workday UX，需要一套在企业级数据组件上更强、扩展能力更稳定的前端技术栈。

本计划将“升级到 MUI X”作为目标，优先解决以下问题：

1. 列表页在复杂筛选、列管理、虚拟滚动、批量操作上的一致性不足。
2. 组织架构树、岗位树、权限树等树形交互缺少统一组件模型。
3. 页面级交互模式与表格交互模式缺乏统一设计约束，导致研发成本和维护成本升高。
4. 缺少可持续扩展的企业级前端能力基座（Data Grid / Tree View / Date Pickers）。

## 2. 目标与非目标

### 2.1 核心目标

- [x] 前端主框架升级为 React + MUI Core + MUI X。
- [x] 建立统一的数据网格能力基线（分页/排序/筛选/列管理/批量选择/导出）。
- [x] 建立统一树形交互能力基线（懒加载/检索/选中保持/多选）。
- [x] 对标 Workday UX 的信息密度与任务流：主导航、列表-详情双栏、任务中心、统一搜索入口。
- [x] 建立可验证的迁移路径：先壳后页、先高价值模块后长尾模块。
- [x] 前端入口采用一次性切换：`/app` 直接切换到 MUI SPA，不保留旧壳兼容入口。

### 2.2 非目标

- 不在本计划内重写后端领域模型、数据库事件模型或权限模型。
- 不在本计划内实现所有页面的像素级 Workday 复刻。
- 不在本计划内保留旧 `/app` 服务端壳兼容路径（已决策直接切换）。
- 不在本计划内引入第二套并行状态管理标准（全局只保留一套）。

## 2.3 工具链与门禁（SSOT 引用）

> 命令入口和触发器矩阵保持以仓库 SSOT 为准，避免在本计划复制脚本细节。

- 触发器矩阵：`AGENTS.md`
- 命令入口：`Makefile`
- CI 门禁：`.github/workflows/quality-gates.yml`
- 质量门禁基线：`docs/dev-plans/012-ci-quality-gates.md`

## 3. 选型与关键决策

### 3.1 目标技术栈（冻结）

- 框架层：React（函数组件 + Hooks）
- UI 基座：MUI Core
- 企业数据组件层：MUI X
- 表单与校验：React Hook Form + Zod（建议）
- 数据请求缓存：TanStack Query（建议）
- 路由：React Router（建议）

### 3.2 MUI X 版本策略

- 基线方案：`DataGridPremium + TreeViewPro + DatePickersPro`（已完成采购授权，可直接启用）。
- Community 能力作为可选降级路径，但不再作为选型限制条件。
- 组件选型原则：默认优先业务体验最优能力，再评估复杂度与维护成本。

### 3.3 设计系统策略

- 以 MUI Theme + Design Tokens 统一颜色、间距、排版、密度。
- 禁止业务模块直接散落硬编码样式（颜色/间距/阴影），必须通过主题变量输出。
- 明确“平台组件层”：`AppShell / PageHeader / DataGridPage / DetailPanel / FilterBar`。

### 3.4 UX 基线（对标 Workday）

- 统一双栏工作区：左侧导航 + 右侧内容区，列表与详情可并行查看。
- 统一任务入口：全局搜索 + 待办/审批面板。
- 列表页默认支持：表头筛选、列冻结、列显示管理、快速筛选、批量操作。
- 统一树交互：展开态与选中态保持、懒加载、树内搜索定位。

## 4. 功能映射（MUI X 能力落位）

### 4.1 数据列表（DataGridPremium）

- 服务端分页、排序、筛选（避免全量前端计算）。
- 表头筛选（Header Filters）、快速筛选（Quick Filter）、多条件过滤。
- 列能力：隐藏/显示、重排、固定（pinning）、宽度持久化。
- 选择能力：单选/多选/跨页选择（按业务策略限制）。

### 4.2 树形结构（Tree View）

- 组织树/岗位树/权限树使用统一 Tree 组件。
- 提供懒加载协议、节点检索、展开态持久化。
- 保留树-表联动能力（选树节点驱动右侧列表过滤）。

### 4.3 时间与表单（Date Pickers + Form）

- 日期输入统一到 MUI 日期组件，消除多组件混用。
- 表单统一校验层与错误展示规范（字段级 + 表单级）。

## 5. 实施步骤

### 5.0 子计划映射（091-095）

- `DEV-PLAN-091`：P0 基座准备与许可落地。
- `DEV-PLAN-092`：P1 壳与导航迁移。
- `DEV-PLAN-093`：P2 高价值模块迁移。
- `DEV-PLAN-094`：P3 长尾迁移与收口。
- `DEV-PLAN-095`：P4 稳定化与性能压测。

### 5.1 Phase 0：基座准备（1~2 周）

1. [x] 锁定 React/MUI/MUI X 主版本与授权使用规范（Pro/Premium 已授权）。
2. [x] 建立新前端工程骨架（目录规范、路由骨架、主题骨架）。
3. [x] 建立平台组件层（Shell、Header、FilterBar、GridPage、DetailPanel）。
4. [x] 建立统一 API 客户端、错误处理与鉴权拦截器。

### 5.2 Phase 1：壳与导航迁移（1~2 周）

5. [x] 完成主导航、顶部栏、全局搜索入口与主布局。
6. [x] 落地 i18n、主题切换、权限菜单裁剪。
7. [x] 建立页面级埋点基础（导航点击、筛选、批量操作）。

### 5.3 Phase 2：高价值模块迁移（2~4 周）

8. [x] 组织架构模块：Tree + DataGrid 双栏闭环。
9. [x] 人员与任职模块：复杂筛选、批量动作、详情侧栏。
10. [x] 审批/待办模块：列表状态流转与详情联动。

### 5.4 Phase 3：长尾迁移与收口（2~4 周）

11. [x] 统一替换旧列表页到 DataGrid 基线组件。
12. [x] 统一替换旧树组件到 Tree 基线组件。
13. [x] 统一样式与交互文案，清理重复组件和死代码。

### 5.5 Phase 4：稳定化与性能压测（1~2 周）

14. [x] 大数据量场景（10k/50k）滚动、筛选、切页性能压测。
15. [x] 完成关键链路 E2E 回归并冻结验收快照。
16. [x] 输出升级完成报告与后续优化清单。

## 6. 验收标准

- [x] 已迁移模块在“树 + 列表 + 详情 + 批量操作”链路可完整闭环。
- [x] 列表页统一具备表头筛选、列配置、服务端分页排序过滤。
- [x] 树形页面统一具备懒加载、搜索定位、展开态保持。
- [x] 页面交互一致性明显提升（导航、筛选、错误反馈、空态、加载态）。
- [x] 迁移后关键场景性能达标：常用页面首屏与交互延迟满足预设阈值。
- [x] 质量门禁与 E2E 门禁稳定通过。

## 7. 测试与质量策略

### 7.1 测试分层

- 单元测试：平台组件、hooks、utils。
- 组件测试：DataGridPage/TreePanel/FilterBar 的行为测试。
- 集成测试：页面级筛选、排序、批量操作、详情联动。
- E2E：核心业务路径（组织、人员、任职、审批）。

### 7.2 质量门禁

- 命中 UI 改动时执行对应前端构建与生成物一致性校验。
- 命中路由与交互改动时执行路由门禁与 E2E。
- 所有门禁执行入口统一走仓库 SSOT（`Makefile` + CI workflow）。

## 8. 风险与缓解

1. **能力过配风险**：高级组件滥用导致页面复杂度抬升。
   - 缓解：按任务闭环评估，只有在确实提升效率/可维护性时启用 Premium 能力。

2. **迁移范围失控**：一次性改动过大导致进度失控。
   - 缓解：模块分批迁移，按页面清单逐批验收。

3. **体验不一致**：新旧页面共存期间交互割裂。
   - 缓解：先落平台组件与交互规范，再批量迁移页面。

4. **性能回退**：复杂网格在大数据量场景出现卡顿。
   - 缓解：强制服务端分页/筛选，启用虚拟滚动并建立压测基线。

## 9. 里程碑与交付物

- [x] `DEV-PLAN-090`（本文，作为升级总方案 SSOT）
- [x] 前端升级实施清单（模块/页面维度）
- [x] 设计系统 token 与组件规范文档
- [x] 迁移验收报告（功能、性能、质量门禁、风险）

## 10. 与既有计划关系

- 质量门禁：`docs/dev-plans/012-ci-quality-gates.md`
- 路由治理：`docs/dev-plans/017-routing-strategy.md`
- i18n（en/zh）：`docs/dev-plans/020-i18n-en-zh-only.md`
- 文档治理：`docs/dev-plans/013-docs-creation-and-governance-guide.md`
- 总体实施路线：`docs/dev-plans/009-implementation-roadmap.md`
